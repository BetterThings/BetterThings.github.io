var hello={settings:{redirect_uri:msos.config.hellojs_redirect,response_type:"token",display:"popup",state:"",default_service:null,force:true},utils:{ut_name:"hello.utils",xhr_request:function(){"use strict";var _1=new XMLHttpRequest();if(_1.withCredentials!==undefined){return _1;}if(XDomainRequest!==undefined){_1=new XDomainRequest();return _1;}return null;},xhr:function(_2,_3,_4){"use strict";var _5=this,r=_5.xhr_request()||null,_6="";msos.console.debug(this.ut_name+".xhr -> start.");if(r!==null){r.onload=function(){var _7={};try{_7=JSON.parse(r.responseText);}catch(e){_7={error:{code:"parse_error",message:e.message}};msos.console.error(_5.ut_name+".xhr - onload -> parse failed: "+e.message);}if(r.status===401){_7={error:{code:"access_denied",message:r.statusText}};msos.console.warn(_5.ut_name+".xhr - onload -> access_denied: "+r.statusText);}_4(_7||{error:{code:"server_error",message:r.status}});};r.onerror=function(){var _8=r.responseText;try{_8=JSON.parse(r.responseText);}catch(e){_8={error:{code:"parse_error",message:e.message}};msos.console.error(_5.ut_name+".xhr - onerror -> parse failed: "+e.message);}_4(_8||{error:{code:"server_error",message:r.status}});};_6=_5.add_qs(_3,_2);r.open("GET",_6,true);r.send();}else{msos.console.debug(this.ut_name+".xhr -> failed, na.");}msos.console.debug(this.ut_name+".xhr -> done!");return r;},add_qs:function(_9,_a){"use strict";var x,_b,_c;if(msos.config.verbose){msos.console.debug(this.ut_name+".add_qs -> start, url: "+_9+", params:",_a);}if(_a&&!_.isEmpty(_a)){for(x in _a){if(_9.indexOf(x)>-1){_b="[\\?\\&]"+x+"=[^\\&]*";_c=new RegExp(_b);_9=_9.replace(_c,"");}}_9+=(_9.indexOf("?")>-1?"&":"?")+this.param(_a);}if(msos.config.verbose){msos.console.debug(this.ut_name+".add_qs -> done, url: "+_9);}return _9;},param:function(s){"use strict";var b,a={},c=[],m,i=0,o,x,_d="";if(msos.config.verbose){msos.console.debug(this.ut_name+".param -> start.");}if(typeof s==="string"){m=s.replace(/^[\#\?]/,"").match(/([^=\/\&]+)=([^\&]+)/g);if(m){for(i=0;i<m.length;i+=1){b=m[i].split("=");a[b[0]]=decodeURIComponent(b[1]);}}if(msos.config.verbose){msos.console.debug(this.ut_name+".param -> done, object:",a);}return a;}o=s;if(_.isObject(o)){for(x in o){if(o.hasOwnProperty(x)){c.push([x,o[x]==="?"?"?":encodeURIComponent(o[x])].join("="));}}_d=c.join("&");}if(msos.config.verbose){msos.console.debug(this.ut_name+".param -> done, string: "+_d);}return _d;},store:function(_e,_f){"use strict";var _10=JSON.parse(localStorage.getItem("hello"))||{};if(_e&&_f===undefined){return _10[_e];}if(_e&&_f===""){try{delete _10[_e];}catch(e){_10[_e]=null;}}else{if(_e){_10[_e]=_f;}else{return _10;}}localStorage.setItem("hello",JSON.stringify(_10));return _10;},append:function(_11,_12,_13){"use strict";var n=typeof _11==="string"?document.createElement(_11):_11,x,y,_14="";msos.console.debug(this.ut_name+".append -> start.");if(typeof _12==="object"){if(_12.tagName){_13=_12;}else{for(x in _12){if(_12.hasOwnProperty(x)){if(typeof (_12[x])==="object"){for(y in _12[x]){if(_12[x].hasOwnProperty(y)){n[x][y]=_12[x][y];}}}else{if(x==="html"){n.innerHTML=_12[x];}else{if(!/^on/.test(x)){n.setAttribute(x,_12[x]);}else{n[x]=_12[x];}}}}}}}if(_13==="body"){_14="body";(function self(){if(document.body){document.body.appendChild(n);}else{setTimeout(_15,16);}}());}else{if(typeof _13==="object"){_14="dom object";_13.appendChild(n);}else{if(typeof _13==="string"){_14=_13;document.getElementsByTagName(_13)[0].appendChild(n);}else{_14="no target";}}}msos.console.debug(this.ut_name+".append -> done, target: "+_14);return n;},merge:function(a,b){"use strict";var x,r={};if(typeof a==="object"&&typeof b==="object"){for(x in a){r[x]=a[x];if(b[x]!==undefined){r[x]=this.merge(a[x],b[x]);}}for(x in b){if(a[x]===undefined){r[x]=b[x];}}}else{r=b;}return r;},Event:function(){"use strict";this.parent={events:this.events,findEvents:this.findEvents,parent:this.parent,utils:this.utils};this.events={};this.on=function(evt,_16){if(_16&&typeof _16==="function"){var a=evt.split(/[\s\,]+/),i=0;for(i=0;i<a.length;i+=1){this.events[a[i]]=[_16].concat(this.events[a[i]]||[]);}}return this;};this.off=function(evt,_17){this.findEvents(evt,function(_18,_19){if(!_17||this.events[_18][_19]===_17){this.events[_18].splice(_19,1);}});return this;};this.emit=function(evt,_1a){var _1b=Array.prototype.slice.call(arguments,1),_1c=this;_1b.push(evt);while(_1c&&_1c.findEvents){_1c.findEvents(evt,function(_1d,_1e){_1b[_1b.length-1]=_1d;this.events[_1d][_1e].apply(this,_1b);});_1c=_1c.parent;}return this;};this.emitAfter=function(){var _1f=this,_20=arguments;setTimeout(function(){_1f.emit.apply(_1f,_20);},10);return this;};this.success=function(_21){return this.on("success",_21);};this.error=function(_22){return this.on("error",_22);};this.failed=function(_23){return this.on("failed",_23);};this.findEvents=function(evt,_24){var a=evt.split(/[\s\,]+/),_25,i=0;for(_25 in this.events){if(this.events.hasOwnProperty(_25)){if(_.indexOf(a,_25)>-1){for(i=0;i<this.events[_25].length;i+=1){_24.call(this,_25,i);}}}}};},globalEvent:function(_26,_27){"use strict";_27=_27||"hellojs_"+parseInt(Math.random()*1000000000000,10).toString(36);msos.console.debug(this.ut_name+".globalEvent -> start, guid: "+_27);window[_27]=function(){var _28=_26.apply(this,arguments);msos.console.debug(_27+" ~~~> start.");if(_28){try{delete window[_27];msos.console.debug(_27+" ~~~> delete: "+_27);}catch(e){msos.console.error(_27+" ~~~> delete failed, reason: "+e.message);}}msos.console.debug(_27+" ~~~> done!");};msos.console.debug(this.ut_name+".globalEvent -> done, guid: "+_27);return _27;}},service:function(_29){"use strict";msos.console.debug("hello.service -> called.");if(_29!==undefined){return this.utils.store("sync_service",_29);}return this.utils.store("sync_service");},services:{},using:function(_2a){"use strict";msos.console.debug("hello.using -> start.");var _2b=Object.create(this);_2b.settings=Object.create(this.settings);if(_2a){_2b.settings.default_service=_2a;}_2b.utils.Event.call(_2b);msos.console.debug("hello.using -> done!");return _2b;},init:function(_2c,_2d){"use strict";if(msos.config.verbose){msos.console.debug("hello.init -> start, service:",_2c);}else{msos.console.debug("hello.init -> start.");}if(_2c){this.services=_.extend(this.services,_2c);if(_2d){this.settings=_.extend(this.settings,_2d);}}else{msos.console.warn("hello.init -> no service input.");}msos.console.debug("hello.init -> done!");},login:function(p){"use strict";var _2e=this.using(),_2f=_2e.utils,url,_30,_31=false,_32,_33,_34,_35,_36=msos.config.size_wide[msos.config.size],_37,_38,_39,_3a;if(msos.config.verbose){msos.console.debug("hello.login -> start, p:",p);}else{msos.console.debug("hello.login -> start.");}p=_.isObject(p)?p:{};p.options=_.isObject(p.options)?p.options:{};p.options=_2f.merge(_2e.settings,p.options);p.network=_2e.settings.default_service=p.network||_2e.settings.default_service;if(!_2e.services[p.network]){_2e.emitAfter("error",{error:{code:"invalid_network",message:p.network}});msos.console.warn("hello.login -> done, network na.");return _2e;}_30=_2e.services[p.network];_32=_2f.globalEvent(function(obj){if(msos.config.verbose){msos.console.debug("hello.login - cb -> start, obj: ",obj);}_31=true;if(obj.error){msos.console.error("hello.login - cb -> error:",obj.error);_2e.emit("failed",{error:obj.error});}else{_2f.store(obj.network,obj);_2e.emit("auth.success",{network:obj.network,authResponse:obj});}if(msos.config.verbose){msos.console.debug("hello.login - cb -> done!");}});p.qs={client_id:_30.id,response_type:p.options.response_type,redirect_uri:p.options.redirect_uri,display:p.options.display,scope:"basic",state:{client_id:_30.id,network:p.network,display:p.options.display,callback:_32,state:p.options.state}};_33=_2f.store(p.network);_35=p.options.scope;if(_35&&typeof _35!=="string"){_35=_35.join(",");}_35=(_35?_35+",":"")+p.qs.scope;if(_33&&_33.scope){_35+=","+_33.scope.join(",");}p.qs.state.scope=_.uniq(_35.split(/[,\s]+/));p.qs.scope=_35.replace(/[^,\s]+/ig,function(m){return _30.scope[m]||"";}).replace(/[,\s]+/ig,",");p.qs.scope=_.uniq(p.qs.scope.split(/,+/)).join(_30.scope_delim||",");if(p.options.force===false){if(_33&&_33.access_token&&_33.expires&&_33.expires>((new Date()).getTime()/1000)){_34=_.difference(_33.scope||[],p.qs.state.scope||[]);if(_34.length===0){msos.console.debug("hello.login -> found user access_token.");_2e.emitAfter("auth.success",{network:p.network,authResponse:_33});return _2e;}}}if(_30.oauth){p.qs.state.oauth=_30.oauth;}p.qs.state=JSON.stringify(p.qs.state);if(_30.login&&typeof (_30.login)==="function"){_30.login(p);}url=_2f.add_qs(_30.oauth.auth,p.qs);msos.console.debug("hello.login -> display: "+p.options.display||"undefined");if(p.options.display==="none"){_2f.append("iframe",{src:url,style:{position:"absolute",left:"-1000px",bottom:0,height:"1px",width:"1px"}},"body");}else{if(p.options.display==="popup"){_37=p.options.window_height||520;_38=p.options.window_width||(_36<520?_36:520);_39=window.open(url,_32+"_window","resizeable=true,height="+_37+",width="+_38+",left="+((window.innerWidth-_38)/2)+",top="+((window.innerHeight-_37)/2));_39.focus();_3a=setInterval(function(){if(_39.closed){clearInterval(_3a);if(!_31){_2e.emit("failed",{error:{code:"login_cancelled",message:p.network}});}}},100);}else{window.location=url;}}msos.console.debug("hello.login -> done!");return _2e;},logout:function(p){"use strict";var _3b=this.using(),x;p=_.isObject(p)?p:{};if(msos.config.verbose){msos.console.debug("hello.logout -> start, p:",p);}else{msos.console.debug("hello.logout -> start.");}p.network=p.network||_3b.settings.default_service;if(!_3b.services[p.network]){_3b.emitAfter("error",{error:{code:"invalid_network",message:p.network}});msos.console.error("hello.logout -> done, invalid network.");return _3b;}if(_3b.utils.store(p.network)){if(typeof (_3b.services[p.network].logout)==="function"){_3b.services[p.network].logout(p);}_3b.utils.store(p.network,"");if(msos.config.verbose){msos.console.debug("hello.logout -> logged out:"+p.network);}}else{if(p.network==="all"){if(msos.config.verbose){msos.console.debug("hello.logout -> logging out of all services.");}for(x in _3b.services){if(_3b.services.hasOwnProperty(x)){_3b.logout(x);}}_3b.service(false);}else{_3b.emitAfter("error",{error:{code:"invalid_session",message:p.network}});msos.console.error("hello.logout -> missing a session for: "+p.network);return _3b;}}_3b.emitAfter("logout.success",true);msos.console.debug("hello.logout -> done!");return _3b;},getAuthResponse:function(_3c){"use strict";msos.console.debug("hello.getAuthResponse -> start.");_3c=_3c||this.settings.default_service;if(!_3c||!(this.services[_3c])){this.emit("error",{error:{code:"invalid_network",message:_3c||"na"}});msos.console.error("hello.getAuthResponse -> done, invalid network.");return null;}msos.console.debug("hello.getAuthResponse -> done!");return this.utils.store(_3c)||null;},events:{}};hello.utils.Event.call(hello);hello.api=function(p){"use strict";msos.console.debug("hello.api -> start.");var _3d=this.using(),_3e=_3d.utils,_3f,o;p.path=(p.path||"me").toLowerCase();p.network=p.network||_3d.settings.default_service||"na";o=_3d.services[p.network]||undefined;if(!o){_3d.emitAfter("error",{error:{code:"invalid_network",message:p.network}});msos.console.error("hello.api -> network na.");return _3d;}_3d.settings.default_service=p.network;if(msos.config.verbose){msos.console.debug("hello.api -> network object:",o);}_3f=function(r){msos.console.debug("hello.api - api_cb -> start.");if(o.error){o.error(r);}_3d.emit("complete "+(!r||r.error?"error":"success"),r);msos.console.debug("hello.api - api_cb -> done!");};function _40(_41){var reg=/[\?\&]([^=&]+)(=([^&]+))?/ig,_42,_43,_44,_45=_3d.getAuthResponse(p.network),_46=(_45?_45.access_token:null),qs={"access_token":_46||""},_47;msos.console.debug("hello.api - processPath -> start, path: "+_41);while((_42=reg.exec(_41))){p.data[_42[1]]=_42[3];}_41=_41.replace(/\?.*/,"");_43=o.get[_41]||_41;_43=_43.replace(/\@\{([a-z\_\-]+)(\|.+?)?\}/gi,function(m,key,_48){var val=_48?_48.replace(/^\|/,""):"";if(p.data[key]){val=p.data[key];delete p.data[key];}else{_3d.emitAfter("error",{error:{code:"invalid_attribute",message:key}});}return val;});_44=o.base+_43;if(!_.isEmpty(p.data)){qs=_3e.merge(qs,p.data);}if(o.querystring){o.querystring(qs);}if(o.jsonp){msos.console.debug("hello.api - processPath -> jsonp");o.jsonp(qs,_44,_3f);}else{msos.console.debug("hello.api - processPath -> XMLHttpRequest");_47=_3e.xhr(qs,_44,_3f);if(_47===null){_3d.emitAfter("error",{error:{code:"browser_warning",message:navigator.userAgent}});msos.console.warn("hello.api - processPath -> browser too old.");}}msos.console.debug("hello.api - processPath -> done!");};if(!o.get[p.path]){msos.console.error("hello.api -> path: "+p.path+" na in: "+p.network);return _3d.emitAfter("error",{error:{code:"invalid_path",message:p.path}});}_40(p.path);msos.console.debug("hello.api -> done!");return _3d;};