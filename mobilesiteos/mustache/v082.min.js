(function(_1,_2){if(typeof exports==="object"&&exports){_2(exports);}else{if(typeof define==="function"&&define.amd){define(_2({}));}else{_1.Mustache=_2({});}}}(this,function(_3){var _4=Object.prototype.toString;var _5=Array.isArray||function(_6){return _4.call(_6)==="[object Array]";};function _7(_8){return typeof _8==="function";};function _9(_a){return _a.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&");};var _b=RegExp.prototype.test;function _c(re,_d){return _b.call(re,_d);};var _e=/\S/;function _f(_10){return !_c(_e,_10);};var _11={"&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#39;","/":"&#x2F;"};function _12(_13){return String(_13).replace(/[&<>"'\/]/g,function(s){return _11[s];});};var _14=/\s*/;var _15=/\s+/;var _16=/\s*=/;var _17=/\s*\}/;var _18=/#|\^|\/|>|\{|&|=|!/;function _19(_1a,_1b){if(!_1a){return [];}var _1c=[];var _1d=[];var _1e=[];var _1f=false;var _20=false;function _21(){if(_1f&&!_20){while(_1e.length){delete _1d[_1e.pop()];}}else{_1e=[];}_1f=false;_20=false;};var _22,_23,_24;function _25(_26){if(typeof _26==="string"){_26=_26.split(_15,2);}if(!_5(_26)||_26.length!==2){throw new Error("Invalid tags: "+_26);}_22=new RegExp(_9(_26[0])+"\\s*");_23=new RegExp("\\s*"+_9(_26[1]));_24=new RegExp("\\s*"+_9("}"+_26[1]));};_25(_1b||_3.tags);var _27=new _28(_1a);var _29,_2a,_2b,chr,_2c,_2d;while(!_27.eos()){_29=_27.pos;_2b=_27.scanUntil(_22);if(_2b){for(var i=0,_2e=_2b.length;i<_2e;++i){chr=_2b.charAt(i);if(_f(chr)){_1e.push(_1d.length);}else{_20=true;}_1d.push(["text",chr,_29,_29+1]);_29+=1;if(chr==="\n"){_21();}}}if(!_27.scan(_22)){break;}_1f=true;_2a=_27.scan(_18)||"name";_27.scan(_14);if(_2a==="="){_2b=_27.scanUntil(_16);_27.scan(_16);_27.scanUntil(_23);}else{if(_2a==="{"){_2b=_27.scanUntil(_24);_27.scan(_17);_27.scanUntil(_23);_2a="&";}else{_2b=_27.scanUntil(_23);}}if(!_27.scan(_23)){throw new Error("Unclosed tag at "+_27.pos);}_2c=[_2a,_2b,_29,_27.pos];_1d.push(_2c);if(_2a==="#"||_2a==="^"){_1c.push(_2c);}else{if(_2a==="/"){_2d=_1c.pop();if(!_2d){throw new Error("Unopened section \""+_2b+"\" at "+_29);}if(_2d[1]!==_2b){throw new Error("Unclosed section \""+_2d[1]+"\" at "+_29);}}else{if(_2a==="name"||_2a==="{"||_2a==="&"){_20=true;}else{if(_2a==="="){_25(_2b);}}}}}_2d=_1c.pop();if(_2d){throw new Error("Unclosed section \""+_2d[1]+"\" at "+_27.pos);}return _2f(_30(_1d));};function _30(_31){var _32=[];var _33,_34;for(var i=0,_35=_31.length;i<_35;++i){_33=_31[i];if(_33){if(_33[0]==="text"&&_34&&_34[0]==="text"){_34[1]+=_33[1];_34[3]=_33[3];}else{_32.push(_33);_34=_33;}}}return _32;};function _2f(_36){var _37=[];var _38=_37;var _39=[];var _3a,_3b;for(var i=0,_3c=_36.length;i<_3c;++i){_3a=_36[i];switch(_3a[0]){case "#":case "^":_38.push(_3a);_39.push(_3a);_38=_3a[4]=[];break;case "/":_3b=_39.pop();_3b[5]=_3a[2];_38=_39.length>0?_39[_39.length-1][4]:_37;break;default:_38.push(_3a);}}return _37;};function _28(_3d){this.string=_3d;this.tail=_3d;this.pos=0;};_28.prototype.eos=function(){return this.tail==="";};_28.prototype.scan=function(re){var _3e=this.tail.match(re);if(!_3e||_3e.index!==0){return "";}var _3f=_3e[0];this.tail=this.tail.substring(_3f.length);this.pos+=_3f.length;return _3f;};_28.prototype.scanUntil=function(re){var _40=this.tail.search(re),_41;switch(_40){case -1:_41=this.tail;this.tail="";break;case 0:_41="";break;default:_41=this.tail.substring(0,_40);this.tail=this.tail.substring(_40);}this.pos+=_41.length;return _41;};function _42(_43,_44){this.view=_43==null?{}:_43;this.cache={".":this.view};this.parent=_44;};_42.prototype.push=function(_45){return new _42(_45,this);};_42.prototype.lookup=function(_46){var _47=this.cache;var _48;if(_46 in _47){_48=_47[_46];}else{var _49=this,_4a,_4b;while(_49){if(_46.indexOf(".")>0){_48=_49.view;_4a=_46.split(".");_4b=0;while(_48!=null&&_4b<_4a.length){_48=_48[_4a[_4b++]];}}else{_48=_49.view[_46];}if(_48!=null){break;}_49=_49.parent;}_47[_46]=_48;}if(_7(_48)){_48=_48.call(this.view);}return _48;};function _4c(){this.cache={};};_4c.prototype.clearCache=function(){this.cache={};};_4c.prototype.parse=function(_4d,_4e){var _4f=this.cache;var _50=_4f[_4d];if(_50==null){_50=_4f[_4d]=_19(_4d,_4e);}return _50;};_4c.prototype.render=function(_51,_52,_53){var _54=this.parse(_51);var _55=(_52 instanceof _42)?_52:new _42(_52);return this.renderTokens(_54,_55,_53,_51);};_4c.prototype.renderTokens=function(_56,_57,_58,_59){var _5a="";var _5b=this;function _5c(_5d){return _5b.render(_5d,_57,_58);};var _5e,_5f;for(var i=0,_60=_56.length;i<_60;++i){_5e=_56[i];switch(_5e[0]){case "#":_5f=_57.lookup(_5e[1]);if(!_5f){continue;}if(_5(_5f)){for(var j=0,_61=_5f.length;j<_61;++j){_5a+=this.renderTokens(_5e[4],_57.push(_5f[j]),_58,_59);}}else{if(typeof _5f==="object"||typeof _5f==="string"){_5a+=this.renderTokens(_5e[4],_57.push(_5f),_58,_59);}else{if(_7(_5f)){if(typeof _59!=="string"){throw new Error("Cannot use higher-order sections without the original template");}_5f=_5f.call(_57.view,_59.slice(_5e[3],_5e[5]),_5c);if(_5f!=null){_5a+=_5f;}}else{_5a+=this.renderTokens(_5e[4],_57,_58,_59);}}}break;case "^":_5f=_57.lookup(_5e[1]);if(!_5f||(_5(_5f)&&_5f.length===0)){_5a+=this.renderTokens(_5e[4],_57,_58,_59);}break;case ">":if(!_58){continue;}_5f=_7(_58)?_58(_5e[1]):_58[_5e[1]];if(_5f!=null){_5a+=this.renderTokens(this.parse(_5f),_57,_58,_5f);}break;case "&":_5f=_57.lookup(_5e[1]);if(_5f!=null){_5a+=_5f;}break;case "name":_5f=_57.lookup(_5e[1]);if(_5f!=null){_5a+=_3.escape(_5f);}break;case "text":_5a+=_5e[1];break;}}return _5a;};_3.name="mustache.js";_3.version="0.8.1";_3.tags=["{{","}}"];var _62=new _4c();_3.clearCache=function(){return _62.clearCache();};_3.parse=function(_63,_64){return _62.parse(_63,_64);};_3.render=function(_65,_66,_67){return _62.render(_65,_66,_67);};_3.to_html=function(_68,_69,_6a,_6b){var _6c=_3.render(_68,_69,_6a);if(_7(_6b)){_6b(_6c);}else{return _6c;}};_3.escape=_12;_3.Scanner=_28;_3.Context=_42;_3.Writer=_4c;return _3;}));