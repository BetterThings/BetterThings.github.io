msos.version=new msos.set_version(14,5,17);msos.console.info("msos/core -> start, "+msos.version);msos.console.time("core");msos.clear_storage=function(){"use strict";var _1="msos.clear_storage -> ";msos.console.debug(_1+"start.");if(Modernizr.sessionstorage){sessionStorage.clear();}if(Modernizr.localstorage){localStorage.clear();}msos.console.debug(_1+"done!");};if(msos.config.clear_storage){msos.clear_storage();}msos.bandwidth_env=function(){"use strict";var _2="msos.bandwidth_env -> ",_3=msos.config.storage.sessionstorage.site_bdwd.name,_4=msos.config.cookie.site_bdwd.value||"na",_5="",_6="";msos.console.debug(_2+"start, sessionStorage: "+(Modernizr.sessionstorage?"enabled":"disabled")+", cookies: "+(navigator.cookieEnabled?"enabled":"disabled"));if(Modernizr.sessionstorage&&navigator.cookieEnabled){_5=sessionStorage.getItem(_3)||"na";if(_4==="na"&&_5==="na"){_6+=", new user!";}else{if(_5==="na"){msos.config.cache=false;_6+=", return user!";}else{_6+=", continuing user!";}}}msos.console.debug(_2+"done, ajax caching set: "+(msos.config.cache?"true":"false")+_6);};msos.bandwidth_env();msos.byid=function(id,_7){"use strict";var _8="msos.byid -> ",_9=null,_a=null;if(_7){_9=_7;}else{_9=window.document;}if(typeof id!=="string"){msos.console.error(_8+"input not an id string!");return null;}_a=jQuery("#"+id,_9)[0];if(_.isElement(_a)){return _a;}msos.console.warn(_8+"na: "+id);return null;};msos.run_onresize=function(){"use strict";var _b="msos.run_onresize -> ",_c=msos.config.view_port.width,m=0;msos.get_viewport(window);msos.console.debug(_b+"start.");for(m=0;m<msos.onresize_functions.length;m+=1){msos.onresize_functions[m]();}msos.console.debug(_b+"done, orig. w: "+_c+", new w: "+msos.config.view_port.width+", for: "+m+" functions.");};msos.run_onorientationchange=function(){"use strict";var _d="msos.run_onorientationchange -> ",_e=msos.config.view_port.width,_f=msos.config.view_orientation,m=0;msos.console.debug(_d+"start, new: "+window.orientation+", pre: "+_f.numeric);if(window.orientation===_f.numeric){msos.console.debug(_d+"done, no change.");return;}jQuery("#body").fadeOut("fast");if(window.orientation===0||window.orientation===180){jQuery(msos.body).css("min-height",_e+"px");}msos.browser_orientation();msos.get_display_size();for(m=0;m<msos.onorientationchange_functions.length;m+=1){msos.onorientationchange_functions[m]();}setTimeout(function(){jQuery("#body").fadeIn("slow");},250);msos.console.debug(_d+"done, orig. w: "+_e+", new w: "+msos.config.view_port.width+", for: "+m+" functions.");};msos.provide=function(_10){"use strict";var _11="msos.provide -> ",_12=_10.replace(/\./g,"_");if(msos.registered_modules[_12]){msos.console.warn(_11+"already registered: "+_10);}else{msos.registered_modules[_12]=true;}msos.console.debug(_11+"executing: "+_10);};msos.require=function(_13,_14){"use strict";var _15="msos.require -> ",_16="",_17=_13.split("."),_18=_17[0],_19=null,_1a=null,_1b=null,uri="";if(!/^[0-9a-zA-Z.-]+$/.test(_13)){msos.console.error(_15+"name not allowed: "+_13);return;}_16=_13.replace(/\./g,"_");if(typeof msos.registered_modules[_16]==="boolean"){if(msos.registered_modules[_16]===true){if(_.isFunction(_14)){_14();}}return;}msos.registered_modules[_16]=false;_19=function(){if(msos.registered_modules[_16]){msos.console.debug(_15+"success: "+_13);}else{msos.console.error(_15+"failed: "+_13);}};if(!msos.registered_folders[_18]){msos.console.debug(_15+"auto resolving module base: "+_18);msos.registered_folders[_18]=msos.resource_url(_18,"");}msos.gen_namespace(_13);if(_17[0]==="msos"&&_17[1]==="i18n"){if(_17.length>2){if(msos.config.verbose){msos.console.debug(_15+"i18n request for: "+_13);}if(typeof msos.registered_modules.msos_i18n!=="boolean"){_17.splice(2);_13=_17.join(".");_16=_17.join("_");msos.registered_modules.msos_i18n=false;}else{return;}}}_17.shift();uri=msos.registered_folders[_18]+_17.join("/")+".js";msos.require_queue+=1;if(msos.config.verbose){msos.console.debug(_15+"request for module: "+uri+", queue: "+msos.require_queue);}_1a=function(){msos.console.debug(_15+"found: "+_13+", queue: "+msos.require_queue);msos.registered_files.ajax[_13]=uri;if(_.isFunction(_14)){_14();}};_1b=function(){msos.console.debug(_15+"completed: "+_13+", queue: "+msos.require_queue);setTimeout(_19,100);msos.require_queue-=1;};msos.ajax_request(uri,"script",_1a,_1b);};msos.template=function(_1c,_1d){"use strict";var _1e="msos.template -> ",_1f=_1c.replace(/\./g,"_"),_20=_1c.split("."),_21=_20[0],_22=null,_23=null,_24=null,uri="";if(!/^[0-9a-zA-Z.-]+$/.test(_1c)){msos.console.error(_1e+"name not allowed: "+_1c);return;}_22=msos.gen_namespace(_1c);if(typeof msos.registered_templates[_1f]==="boolean"){if(msos.registered_templates[_1f]===true){if(_.isFunction(_1d)){_1d(_22);}}return;}msos.registered_templates[_1f]=false;if(!msos.registered_folders[_21]){msos.console.debug(_1e+"auto resolving template base: "+_21);msos.registered_folders[_21]=msos.resource_url(_21,"");}_20.shift();uri=msos.registered_folders[_21]+_20.join("/")+".html";msos.require_queue+=1;if(msos.config.verbose){msos.console.debug(_1e+"request for template: "+uri+", queue: "+msos.require_queue);}_23=function(_25){if(typeof _25==="string"&&_25.length>0){_22.text=_25;_22.name=_1f;msos.registered_templates[_1f]=true;msos.console.debug(_1e+"found: "+_1c+", queue: "+msos.require_queue);if(_.isFunction(_1d)){_1d(_22);}}else{_22.text="";msos.console.error(_1e+"failed, no data: "+_1c+", queue: "+msos.require_queue);}};_24=function(){msos.console.debug(_1e+"completed: "+_1c+", queue: "+msos.require_queue);msos.require_queue-=1;};msos.ajax_request(uri,"html",_23,_24);};msos.ajax_request=function(_26,_27,_28,_29){"use strict";var _2a="msos.ajax_request -> ",_2b=msos.generate_url_name(_26),st=msos.new_time(),_2c=function(_2d,_2e,xhr){if(typeof _2d==="string"&&_2d.length>0){var et=msos.new_time(),sec=(et-st)/1000,_2f=_2d.length*8,bps=Math.round(_2f/sec),_30=parseInt(bps/1024,10);msos.ajax_loading_kbps[_2b]=_30;}if(msos.config.verbose){msos.console.debug(_2a+"status: "+_2e+", data length: "+(_2d.length||0));}if(_.isFunction(_28)){_28(_2d,_2e,xhr);}},_31=function(xhr,_32){var _33=xhr.status+", status: "+_32;if(msos.config.verbose){msos.console.debug(_2a+"completed: "+_33);}if(_.isFunction(_29)){_29(xhr,_32);}};jQuery.ajax({url:_26,dataType:_27,cache:msos.config.cache,success:_2c,error:msos.ajax_error,complete:_31});};msos.ajax_error=function(xhr,_34,_35){"use strict";var _36=_34+": "+_35,_37="",_38={};if(msos.i18n&&msos.i18n.common&&msos.i18n.common.bundle){_38=msos.i18n.common.bundle;}switch(xhr.status){case 200:_37=_38.internal||"Internal error";break;case 404:_37=_38.input||"Input error";break;case 407:_37=_38.authentication||"Authentication error";break;case 500:_37=_38.server||"Server error";break;case 504:_37=_38.timeout||"Timeout error";break;default:_37=_38.unknown||"Unknown error";}_37+=" ("+(xhr.status||"no status")+")";msos.notify.error(_35,_37);if(msos.require_queue>0){_37+=", ref. req. queue "+msos.require_queue;}if(msos.i18n_queue>0){_37+=", ref. i18n queue "+msos.i18n_queue;}_37="msos.ajax_error -> failed: "+_36+", xhr: "+_37;if(msos.config.verbose){msos.console.error(_37,xhr);}else{msos.console.error(_37);}};msos.hide_mobile_url=function(){"use strict";window.scrollTo(0,1);var _39=window.pageYOffset||(window.document.compatMode==="CSS1Compat"&&window.document.documentElement.scrollTop)||window.document.body.scrollTop||0;msos.console.debug("msos.hide_mobile_url -> called, scrollTop: "+_39);setTimeout(function(){window.scrollTo(0,_39===1?0:1);},1);};msos.notify={container:jQuery("<div id='notify_container'></div>"),add:function(){"use strict";var _3a=msos.notify.container;jQuery("body").append(_3a);_3a.position({of:window,my:"center top+60",at:"center top",collision:"none"});_3a.css("position","fixed");},idx:0,queue:[],run:function(){"use strict";var _3b="msos.notify.run -> ",_3c=msos.notify,_3d=_3c.queue[_3c.idx];if(_.isObject(_3d)){msos.console.debug(_3b+"prepend, idx: "+_3c.idx+", type: "+_3d.type);_3c.container.prepend(_3d.note_el);_3d.auto_delay=setTimeout(_3d.fade_out,_3d.delay);_3c.idx+=1;}else{msos.console.debug(_3b+"clear, idx: "+_3c.idx);_3c.idx=0;_3c.queue=[];}},base:function(_3e,_3f,_40,_41,_42){"use strict";var _43="msos.notify.base -> ",_44=msos.notify,_45=String(_44.idx),_46={type:_3e,delay:_42||4000,auto_delay:0,icon_el:null,butt_el:jQuery("<button class='btn btn-danger btn-small fa fa-times'></button>"),note_el:jQuery("<div class='notify'></div>"),disp_el:jQuery("<div class='notify_display'></div>"),titl_el:jQuery("<div class='notify_title'></div>"),msg_el:jQuery("<div class='notify_msg'></div>")};msos.console.debug(_43+"start, idx: "+_44.idx+", type: "+_3e);_46.disp_el.append(_46.butt_el);if(_41){_46.icon_el=jQuery(_41);_46.note_el.append(_46.icon_el);}if(_40){_46.titl_el.append(document.createTextNode(_40));_46.disp_el.append(_46.titl_el);}if(_3f){_46.msg_el.append(document.createTextNode(_3f));_46.disp_el.append(_46.msg_el);}_46.note_el.append(_46.disp_el);_46.fade_out=function(){if(_46.auto_delay===0){_44.idx+=1;}else{clearTimeout(_46.auto_delay);_46.note_el.fadeOut("slow",function(){msos.console.debug(_43+"fade_out, idx: "+_45+", type: "+_3e);_46.note_el.remove();msos.notify.run();});}};_46.butt_el.on("click",_46.fade_out);if(_44.queue.length===0){_44.queue.push(_46);_44.run();}else{_44.queue.push(_46);}msos.console.debug(_43+"done!");return _46;},info:function(_47,_48){"use strict";var obj=new msos.notify.base("info",_47,_48,"<i class=\"fa fa-info-circle fa-2x info\">");return obj;},warning:function(_49,_4a){"use strict";var obj=new msos.notify.base("warning",_49,_4a,"<i class=\"fa fa-warning fa-2x warning\">",6000);return obj;},error:function(_4b,_4c){"use strict";var obj=new msos.notify.base("error",_4b,_4c,"<i class=\"fa fa-ban fa-2x error\">",8000);return obj;},success:function(_4d,_4e){"use strict";var obj=new msos.notify.base("success",_4d,_4e,"<i class=\"fa fa-check-circle fa-2x success\">");return obj;},loading:function(_4f,_50){"use strict";var obj=new msos.notify.base("loading",_4f,_50,"<i class=\"fa fa-spinner fa-spin fa-2x loading\">",10000);return obj;}};window.onerror=function(msg,url,_51,col,er){"use strict";var _52="JavaScript Error!";msos.console.error("window.onerror -> fired, line: "+_51+", url: "+url+", error: "+msg,er);if(msos.i18n&&msos.i18n.common&&msos.i18n.common.bundle){_52=msos.i18n.common.bundle.error||_52;}msos.notify.error(msg,_52);return true;};msos.check_deferred_scripts=function(){"use strict";var _53="msos.check_deferred_scripts -> ",_54=true,_55=msos.registered_files.js,_56="",_57="";msos.require_deferred+=1;for(_57 in _55){_56=_55[_57].getAttribute("defer")||false;if(_56&&_55[_57].msos_load_state!=="loaded"){_54=false;msos.console.debug(_53+"still loading: "+_57+", attemp: "+msos.require_deferred);}}if(msos.require_deferred>9){if(msos.config.verbose){prompt("A deferred script failed to load. Click OK to continue.");}setTimeout(function(){location.reload();},100);}else{if(_54){if(msos.config.mobile){msos.hide_mobile_url();}msos.notify.add();msos.run_intial();msos.run_onload();}else{setTimeout(msos.check_deferred_scripts,100);}}};msos.check_resources=function(){"use strict";var _58="msos.check_resources -> ",_59="",_5a=0,_5b=0,_5c=document.getElementsByTagName("script")||[],src,i,_5d={modules:"module(s)",files:"file(s)",load_error:"Loading Error!",load_failed:"failed to load."},key="",_5e="";for(_59 in msos.registered_modules){if(!msos.registered_modules[_59]){msos.console.error(_58+"module failed to load: "+(_59.replace(/_/g,".")));_5a+=1;}}for(i=0;i<_5c.length;i+=1){if(_5c[i].readyState&&(_5c[i].readyState!=="loaded"||_5c[i].readyState!=="complete")){src=_5c[i].getAttribute("src")||"";if(src){msos.console.error(_58+"file failed to load: "+src);_5b+=1;}}}if(_5a>0||_5b>0){if(msos.i18n&&msos.i18n.common&&msos.i18n.common.bundle){for(key in _5d){if(msos.i18n.common.bundle[key]){_5d[key]=msos.i18n.common.bundle[key];}}}if(_5a>0){_5e+=_5a+" "+_5d.modules;_5e+=_5b>0?", ":"";}if(_5b>0){_5e+=_5b+" "+_5d.files;}_5e+=" "+_5d.load_failed;msos.notify.error(_5e,_5d.load_error);}};msos.set_bandwidth=function(){"use strict";var _5f="msos.set_bandwidth -> ",_60="",cfg=msos.config,_61=cfg.storage.sessionstorage.site_bdwd,_62=cfg.cookie.site_bdwd.value||"na",_63=msos.ajax_loading_kbps,_64={},_65="",_66=false,cnt=0,sum=0,avg=0,i=0;if(cfg.clear_cookies){_60=", cleared cookies";}if(cfg.clear_storage){_60+=", cleared storage";}if(cfg.clear_cookies&&cfg.clear_storage){msos.console.warn(_5f+"simulated new user: browser cache cleared?");}if(cfg.verbose){_60+=", request ajax bandwidth: ";msos.console.debug(_5f+"start"+_60,_63);}else{_60+=".";msos.console.debug(_5f+"start"+_60);}if(Modernizr.sessionstorage&&navigator.cookieEnabled){msos.console.debug(_5f+"using sessionStorage!");_64=sessionStorage.getItem(_61.name)?JSON.parse(sessionStorage.getItem(_61.name)):{};if(cfg.verbose){msos.console.debug(_5f+"sessionStorage bandwidth: ",_64);}for(_65 in _63){_64[_65]=_63[_65];_66=true;}if(_66){msos.console.debug(_5f+"new value(s) added!");for(_65 in _64){sum+=parseInt(_64[_65],10);cnt+=1;}avg=sum/cnt;_61.value=JSON.stringify(_64);sessionStorage.setItem(_61.name,_61.value);_61.set=true;}else{msos.console.debug(_5f+"no new values, use cookie!");avg=_62!=="na"?_62:10;}}else{if(_62==="na"&&navigator.cookieEnabled){msos.console.debug(_5f+"use current loading data!");for(i=0;i<_63.length;i+=1){sum+=parseInt(_63[i],10);}avg=_63.length?(sum/_63.length):10;}else{msos.console.debug(_5f+"use previous cookie or default!");avg=_62!=="na"?_62:10;}}cfg.cookie.site_bdwd.value=parseInt(avg,10);cfg.cookie.site_bdwd.set=true;msos.console.debug(_5f+"done, bandwidth: "+parseInt(avg,10));};msos.connection=function(){"use strict";var _67="msos.connection -> ",_68=navigator.connection||{type:0,bandwidth:0,metered:false},_69=msos.config.connection,_6a="na",_6b=0,_6c=function(val,low,_6d){return low<_6d?val>=low&&val<=_6d:val>=_6d&&this<=low;};if(msos.config.verbose){msos.console.debug(_67+"start, nav. input: ",_68);}if(!msos.config.cookie.site_bdwd.set){msos.console.warn(_67+"calc'd bandwidth not available yet!");}if(_68.bandwidth&&!msos.var_is_empty(_68.bandwidth)){_6b=_68.bandwidth;}else{_6b=msos.config.cookie.site_bdwd.value||10;}if(_68.type===1){_6a="fast";}if(_68.type===2){_6a="fast";}if(/wifi|ethernet/i.test(_68.type)){_6a="fast";}if(_68.type===3||/2g$/i.test(_68.type)){_6a="2g";}if(_68.type===4||/3g$/i.test(_68.type)){_6a="3g";}if(/4g$/i.test(_68.type)){_6a="4g";}if(_6a==="na"){_6a=_6c(_6b,1,50)?"slow":_6c(_6b,51,150)?"2g":_6c(_6b,151,600)?"3g":_6c(_6b,601,1000)?"4g":"fast";}_69.type=_6a;_69.bandwidth=_6b;_69.metered=_68.metered?true:false;if(msos.config.verbose){msos.console.debug(_67+"done, output: ",_69);}};msos.set_window_onchange=function(){"use strict";var _6e="msos.set_window_onchange -> ";msos.console.debug(_6e+"start.");if(msos.onresize_functions.length>0){jQuery(window).on("resize",_.throttle(msos.run_onresize,200));}if(msos.config.orientation&&msos.config.orientation_change){jQuery(window).on("orientationchange",_.debounce(msos.run_onorientationchange,300,true));}msos.console.debug(_6e+"done!");};msos.run_intial=function(){"use strict";var _6f="msos.run_intial -> ",cfg=msos.config,req=msos.require;msos.console.debug(_6f+"start.");msos.body=window.document.body||window.document.getElementsByTagName("body")[0];msos.head=msos.get_head(window);msos.html=window.document.getElementsByTagName("html")[0];msos.docl=document.compatMode==="BackCompat"?window.document.body:window.document.documentElement;msos.browser_direction();if(cfg.visualevent){req("msos.visualevent");}if(cfg.mobile){req("msos.mobile");}if(cfg.run_onerror){req("msos.onerror");}if(cfg.debug_output){req("msos.debug");}if(cfg.console){req("msos.pyromane");}msos.console.debug(_6f+"done!");};msos.run_final=function(){"use strict";var _70="msos.run_final";msos.console.debug(_70+" -> start.");msos.run_function_array("onload_func_post");msos.set_locale_cookie();if(msos.debug){msos.debug.timing();}msos.console.debug(_70+" -> done!");if(msos.pyromane){setTimeout(msos.pyromane.run,500);}msos.run_onload_incr+=1;};msos.run_onload_incr=1;msos.run_onload=function(){"use strict";var _71="msos.run_onload ("+msos.run_onload_incr+") =====> ",cfg=msos.config,_72=100,_73=_72/1000,_74,cc=cfg.cookie;if(msos.require_attempts===0){msos.console.time("run_onload");if(cfg.verbose){msos.console.debug(_71+"start.",cfg);}else{msos.console.debug(_71+"start.");}msos.run_function_array("onload_func_pre");setTimeout(msos.run_onload,_72);msos.require_attempts+=1;return;}if(msos.require_queue===0&&msos.i18n&&!msos.i18n.done){msos.i18n.module_add();msos.i18n.done=true;setTimeout(msos.run_onload,_72);msos.require_attempts+=1;return;}if(msos.require_queue===0&&msos.i18n_queue===0&&!cc.site_bdwd.set){msos.set_bandwidth();msos.connection();msos.set_window_onchange();msos.cookie(cc.site_pref.name,cc.site_pref.value,cc.site_pref.params);cc.site_pref.set=true;msos.cookie(cc.site_bdwd.name,cc.site_bdwd.value,cc.site_bdwd.params);setTimeout(msos.run_onload,_72);msos.require_attempts+=1;return;}if(msos.require_queue===0&&msos.i18n_queue===0&&msos.onload_func_start.length>0){msos.run_function_array("onload_func_start");setTimeout(msos.run_onload,_72);msos.require_attempts+=1;return;}if(msos.require_queue===0&&msos.i18n_queue===0){msos.run_function_array("onload_functions");msos.run_function_array("onload_func_done");if(cfg.verbose){msos.console.debug(_71+"done, modules and templates: ",msos.registered_modules,msos.registered_templates);}else{msos.console.debug(_71+"done!");}msos.require_attempts=0;if(msos.i18n){msos.i18n.done=false;}msos.console.timeEnd("run_onload");setTimeout(msos.run_final,_72);}else{if(_.indexOf([10,20,40,80,100,100],msos.require_attempts)!==-1){msos.console.warn(_71+"waited: "+(msos.require_attempts*_73)+" secs.");}else{if(msos.require_attempts>100){_74=function(){msos.console.error(_71+"failed, module queue: "+msos.require_queue+", i18n queue: "+msos.i18n_queue);msos.notify.warning(jQuery("title").text(),"Page Timed Out");msos.check_resources();};setTimeout(_74,400);return;}}setTimeout(msos.run_onload,_72);msos.require_attempts+=1;}};jQuery(document).ready(msos.check_deferred_scripts);msos.registered_modules.msos=true;msos.console.info("msos/core -> done!");msos.console.timeEnd("core");