(function(_1,_2){if(typeof exports==="object"&&typeof require==="function"){module.exports=_2(require("backbone"));}else{if(typeof define==="function"&&define.amd){define(["backbone"],function(_3){return _2(_3||_1.Backbone);});}else{_2(Backbone);}}}(this,function(_4){function S4(){return (((1+Math.random())*65536)|0).toString(16).substring(1);};function _5(){return (S4()+S4()+"-"+S4()+"-"+S4()+"-"+S4()+"-"+S4()+S4()+S4());};function _6(_7,_8){var i=_7.length;while(i--){if(_7[i]===_8){return true;}}return false;};function _9(_a,_b){for(var _c in _b){_a[_c]=_b[_c];}return _a;};_4.LocalStorage=window.Store=function(_d,_e){if(!this.localStorage){throw "Backbone.localStorage: Environment does not support localStorage.";}this.name=_d;this.serializer=_e||{serialize:function(_f){return _.isObject(_f)?JSON.stringify(_f):_f;},deserialize:function(_10){return _10&&JSON.parse(_10);}};var _11=this.localStorage().getItem(this.name);this.records=(_11&&_11.split(","))||[];};_9(_4.LocalStorage.prototype,{save:function(){this.localStorage().setItem(this.name,this.records.join(","));},create:function(_12){if(!_12.id){_12.id=_5();_12.set(_12.idAttribute,_12.id);}this.localStorage().setItem(this.name+"-"+_12.id,this.serializer.serialize(_12));this.records.push(_12.id.toString());this.save();return this.find(_12)!==false;},update:function(_13){this.localStorage().setItem(this.name+"-"+_13.id,this.serializer.serialize(_13));var _14=_13.id.toString();if(!_6(this.records,_14)){this.records.push(_14);this.save();}return this.find(_13)!==false;},find:function(_15){return this.serializer.deserialize(this.localStorage().getItem(this.name+"-"+_15.id));},findAll:function(){var _16=[];for(var i=0,id,_17;i<this.records.length;i++){id=this.records[i];_17=this.serializer.deserialize(this.localStorage().getItem(this.name+"-"+id));if(_17!=null){_16.push(_17);}}return _16;},destroy:function(_18){if(_18.isNew()){return false;}this.localStorage().removeItem(this.name+"-"+_18.id);var _19=_18.id.toString();for(var i=0,id;i<this.records.length;i++){if(this.records[i]===_19){this.records.splice(i,1);}}this.save();return _18;},localStorage:function(){return localStorage;},_clear:function(){var _1a=this.localStorage(),_1b=new RegExp("^"+this.name+"-");_1a.removeItem(this.name);for(var k in _1a){if(_1b.test(k)){_1a.removeItem(k);}}this.records.length=0;},_storageSize:function(){return this.localStorage().length;}});_4.LocalStorage.sync=window.Store.sync=_4.localSync=function(_1c,_1d,_1e){var _1f=_1d.localStorage||_1d.collection.localStorage;var _20,_21;var _22=_4.$?(_4.$.Deferred&&_4.$.Deferred()):(_4.Deferred&&_4.Deferred());try{switch(_1c){case "read":_20=_1d.id!=undefined?_1f.find(_1d):_1f.findAll();break;case "create":_20=_1f.create(_1d);break;case "update":_20=_1f.update(_1d);break;case "delete":_20=_1f.destroy(_1d);break;}}catch(error){if(error.code===22&&_1f._storageSize()===0){_21="Private browsing is unsupported";}else{_21=error.message;}}if(_20){if(_1e&&_1e.success){if(_4.VERSION==="0.9.10"){_1e.success(_1d,_20,_1e);}else{_1e.success(_20);}}if(_22){_22.resolve(_20);}}else{_21=_21?_21:"Record Not Found";if(_1e&&_1e.error){if(_4.VERSION==="0.9.10"){_1e.error(_1d,_21,_1e);}else{_1e.error(_21);}}if(_22){_22.reject(_21);}}if(_1e&&_1e.complete){_1e.complete(_20);}return _22&&_22.promise();};_4.ajaxSync=_4.sync;_4.getSyncMethod=function(_23){if(_23.localStorage||(_23.collection&&_23.collection.localStorage)){return _4.localSync;}return _4.ajaxSync;};_4.sync=function(_24,_25,_26){return _4.getSyncMethod(_25).apply(this,[_24,_25,_26]);};return _4.LocalStorage;}));